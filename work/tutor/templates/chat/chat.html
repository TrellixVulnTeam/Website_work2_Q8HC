{% load static %}
  <!DOCTYPE html>
  <html>
    <head onload=provoke()>

        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link type="text/css" rel="stylesheet" href="{% static 'css/materialize.min.css' %}"  media="screen,projection"/>
        <link type="text/css" rel="stylesheet" href="{% static 'css/style.css' %}"  media="screen,projection"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="{% static 'js/materialize.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/chat.js' %}"></script>

    </head>
    <body  onload=provoke()>
    <nav class="blue lighten-3">
        <style>
            ul {
                list-style: none  ;
              list-style-type: none;
              margin: 0;
              padding: 0;
              overflow: hidden;
            }
            
            li {
              float: left;
            }
            
            li a {
              display: block;
              color: white;
              text-align: center;
              padding: 14px 16px;
              text-decoration: none;
            }
            
            li a:hover:not(.active) {
              background-color: #111;
            }
            
            .active {
              background-color: #4CAF50;
            }
            </style>

        <ul style="background-color: #333;">
            <li><a  href="#">TutorLabs.com </a></li>
            <li > <a href="#"> Dashboard </a></li>
            <li> <a href="#">  Mytutors</a></li>
            <li> <a href="#"> Reports  </a></li>
            <li> <a href="#"> Messages </a></li>


          </ul>

          

    </nav>

    <script>
        var done = 0 ; 
        var connect_id = 0 ; 


    function ok(){ document.getElementById("board").innerHTML = "";}
    </script>




<div class="container"> 
        <div class="section" style="height: 80vh">
    <div class="row">
        <div class="col s3">
        <div class="card">
            <div class="collection">
          

                {% for user in users %} 
                <button  class="user_select" onclick=change_connect({{user.connect_id}},{{user.teacher_id}},{{user.student_id}})> <p style="text-align: left; font-size: medium; margin-left: 10px;">  {{user.connect_title}}  <hr>  </p> <p style=" text-align:left; margin-left: 20px ; font-size: 10px; color:rgb(139, 138, 138)"> {{user.connect_details}}      </p></button>                    
           
                {% endfor %}


            </div>
        </div>
        </div>
        
        <div class="col s9">
         <div class="card">
             <div  id="above_bar"  style="background-color: rgb(65, 45, 83); display: none ;" >
                <ul style="padding: 10px;"> 
                    <li   style="padding:10px "> <img id="receiveimage" width=50 height=50 style="border-radius: 25px;" >  </li>
                    <li id="receivename" style="padding-top: 25px ; color: white;"> Userid  </li>
                </ul> 

             </div>
          <div id="board" class="section grey lighten-3" style="height: 68vh; padding: 5px; overflow-y: scroll">

         
            </div>


        <form id="chat-box" style="width:100% ; display: none ;" class="form-group" action="api/messages" method="post">
            {% csrf_token %}
                <ul style="width:100% ; list-style:none" >
                    <li style="width:80%" >
                        <input style="width:100%"   id="id_message" name="message" type="text" placeholder="Type your message.."> 
                       
                    </li>
                    <li>
                        <input  id="sender" name="sender" type="hidden" value="{{sender}}"> 
                        
                    </li>
                    <li>
                        <button  class="btn btn-floating blue lighten-2 waves-effect waves-light"><i class="material-icons">send</i></button>
                        
                    </li>
                    <li>  
                        <label for="post-text" form="post-form" ><img src="/media/cars/attach.png" width=30 height=30> </label>
                        <input id="post-text" form="post-form" name="post-text" type="file" hidden/> 
                    </li>
                    <li>

                        <input name="sender" form="post-form" value="{{sender}}" hidden>
                        <input form="post-form" type="submit" >

                    </li>
                </ul>
                        
                    
        
        </form>    

              
        <form id="post-form" class="form-group"    enctype = "multipart/form-data"  method = "POST" >
            {% csrf_token %}


        </form>

</ul>

  

            </div>
        </div>
    </div>
        </div>
    </div>
        {% load static %}
        <script>
         var token = '{{csrf_token}}';
            function change_connect(connecty , student , teacher  ) {
                connect_id = connecty ;
                document.getElementById("board").innerHTML = "";
                
                if (student == {{sender}} ) 
                {
                    set_receiver_details(teacher) ; 
                } 
                if(teacher== {{sender}} ) {
                    set_receiver_details(student) ; 

                }
                document.getElementById("receiveimage").src = receive_details.image ;

            document.getElementById("receivename").innerHTML =  receive_details.first_name ;

            document.getElementById("chat-box").style.display = "block";
                document.getElementById("above_bar").style.display = "block";


            receive({{sender}} , connect_id  , 0 )  ;

            } 
        $(function () {
            scrolltoend(); 

            $('#chat-box').on('submit', function (event) {
                event.preventDefault();
                var message = new FormData(this) ; 
                message.append('connect_id' , connect_id) ;
                send( message, {{sender}} ); //Send function will be defined within 'chat.js'
                
            })


        $("#post-form").on("submit" ,  function(e){
            event.preventDefault();
            console.log("form submitted!")  // sanity check
            var formData = new FormData(this);

            formData.append('connect_id' , connect_id) ;

            create_post( {{sender}} , formData );

         }) 
        




        })
    window.setInterval(function(data){
  /// call your function here
 if(done!=0)
{  
    getElementById("connect_id").value = connect_id ; 
    receive({{sender}} ,  connect_id , 1) ;
}
}, 50000);

function provoke(){

    set_user_details({{sender}}) ; 

}




        </script>
    </body>
    </html>